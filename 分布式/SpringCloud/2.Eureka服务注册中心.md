# 一、服务注册中心

注意：**服务注册中心本质上是为了解耦服务提供者和服务消费者。**

对于任何一个微服务，原则上都应存在或者支持多个提供者(比如简历微服务部署 多个实例)，这是由微服务的`分布式属性`决定的。更进一步，为了支持弹性扩缩容特性，**一个微服务的提供者的数量和分布往往是动 态变化的，也是无法预先确定的**。因此，原本在单体应用阶段常用的静态LB机制就 不再适用了，需要引入额外的组件来管理微服务提供者的注册与发现，而这个组件 就是`服务注册中心`

# 二、服务注册中心的一般原理

![image-20220310003054118](https://cdn.wuzx.cool/image-20220310003054118.png)

分布式微服务架构中，服务注册中心用于存储服务提供者地址信息、服务发布相关的属性信息，消费者通过主动查询和被动通知的方式获取服务提供者的地址信息，而不再需要通过硬编码方式得到提供者的地址信息。消费者只需要知道当前系统发布了那些服务，而不需要知道服务具体存在于什么位置，这就是透明化路由

+ 1)服务提供者启动 
+ 2)服务提供者将相关服务信息主动注册到注册中心 
+ 3)服务消费者获取服务注册信息:
  + pull模式:服务消费者可以主动拉取可用的服务提供者清单
  + push模式:服务消费者订阅服务(当服务提供者有变化时，注册中心也会主动推送 更新后的服务清单给消费者
+ 服务消费者直接调用服务提供者
+ 另外，注册中心也需要完成服务提供者的健康监控，当发现服务提供者失效时需要及时剔除;

# 三、主流服务中心对比 **Zookeeper**

## 3.1Zookeeper

它是一个分布式服务框架，是Apache Hadoop 的一个子项目，它主 要是用来解决分布式应 用中经常遇到的一些数据管理问题，如:统一命名服 务、状态同步服务、集群管理、分布式应用配置项的管理等。

简单来说zookeeper本质=存储+监听通知。

znode

Zookeeper 用来做服务注册中心，主要是因为它具有节点变更通知功能，只要 客户端监听相关服务节点，服务节点的所有变更，都能及时的通知到监听客户 端，这样作为调用方只要使用 Zookeeper 的客户端就能实现服务节点的订阅和 变更通知功能了，非常方便。另外，Zookeeper 可用性也可以，因为只要半数 以上的选举节点存活，整个集群就是可用的。3

## 3.2 **Eureka**

由Netflix开源，并被Pivatal集成到SpringCloud体系中，它是基于 RestfulAPI ⻛格开发的服务注册与发现组件。

# **3.3 Consul**

Consul是由HashiCorp基于Go语言开发的支持多数据中心分布式高可用的服务 发布和注册服务软件， 采用Raft算法保证服务的一致性，且支持健康检查。

## 3.4 **Nacos**

Nacos是一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平 台。简单来说 Nacos 就是 注册中心 + 配置中心的组合，帮助我们解决微服务开 发必会涉及到的服务注册 与发现，服务配置，服务管理等问题。Nacos 是 Spring Cloud Alibaba 核心组件之一，负责服务注册与发现，还有配置。

# 四、服务注册中心组件 **Eureka**

![image-20220310013151639](https://cdn.wuzx.cool/image-20220310013151639.png)

## 4.1 Eureka 交互流程及原理

![image-20220310013209224](https://cdn.wuzx.cool/image-20220310013209224.png)

Eureka 包含两个组件:Eureka Server 和 Eureka Client，Eureka Client是一个 Java客户端，用于简化与Eureka Server的交互;Eureka Server提供服务发现的 能力，各个微服务启动时，会通过Eureka Client向Eureka Server 进行注册自己 的信息(例如网络信息)，Eureka Server会存储该服务的信息

+ 2)图中每一个Eureka Server都是一个集群。

+ 3)图中Application Service作为服务提供者向Eureka Server中注册服务， Eureka Server接受到注册事件会在集群和分区中进行数据同步，Application Client作为消费端(服务消费者)可以从Eureka Server中获取到服务注册信 息，进行服务调用。

+ 4)微服务启动后，会周期性地向Eureka Server发送心跳(默认周期为30秒) 以续约自己的信息

+ 5)Eureka Server在一定时间内没有接收到某个微服务节点的心跳，Eureka Server将会注销该微服务节点(默认90秒)

+ 6)每个Eureka Server同时也是Eureka Client，多个Eureka Server之间通过复 制的方式完成服务注册列表的同步

+ 7)Eureka Client会缓存Eureka Server中的信息。即使所有的Eureka Server节 点都宕掉，服务消费者依然可以使用缓存中的信息找到服务提供者

**Eureka**通过心跳检测、健康检查和客户端缓存等机制，提高系统的灵活性、可 伸缩性和可用性。