Session共享及Session保持或者叫做Session一致性

![image-20211211110409555](https://cdn.wuzx.cool/image-20211211110409555.png)

# **Session**问题原因分析

根本上来说是因为Http协议是无状态的协议。客户端和服务端在某次会话中产 生的数据不会被保留下来，所以第二次请求服务端无法认识到你曾经来过， Http为什么要设计为无状态 协议?早期都是静态⻚面无所谓有无状态，后来有动态的内容更丰富，就需要有状态，出现了两种用于 保持Http状态的技术，那就是Cookie和Session。而出现上述不停让登录的问题，分析如下图:

场景:nginx默认轮询策略

![image-20211211110700024](https://cdn.wuzx.cool/image-20211211110700024.png)

# 解决**Session**一致性的方案



## 1.Nginx的 IP_Hash 策略(可以使用)

同一个客户端IP的请求都会被路由到同一个目标服务器，也叫做会话粘滞

优点:

+   配置简单，不入侵应用，不需要额外修改代码

缺点:

+ 服务器重启Session丢失
+ 存在单点负载高的⻛险
+ 单点故障问题

## 2.Session复制(不推荐)

多个tomcat之间通过修改配置文件，达到Session之间的复制

![image-20211211112316968](https://cdn.wuzx.cool/image-20211211112316968.png)

+ 优点:
  + 不入侵应用
  + 便于服务器水平扩展 
  + 能适应各种负载均衡策略 
  + 服务器重启或者宕机不会造成Session丢失
+ 缺点:
  + 性能低
  + 内存消耗
  + 不能存储太多数据，否则数据越多越影响性能  
  + 延迟性

## 3.Session共享，Session集中存储(推荐)

Session的本质就是缓存，那Session数据为什么不交给专业的缓存中间件呢?比如Redis

![image-20211211112454635](https://cdn.wuzx.cool/image-20211211112454635.png)

+ 优点:
  + 能适应各种负载均衡策略 
  + 服务器重启或者宕机不会造成Session丢失 
  + 扩展能力强
  + 适合大集群数量使用
+ 缺点:
  + 对应用有入侵，引入了和Redis的交互代码

## 原理

![image-20211211112956145](https://cdn.wuzx.cool/image-20211211112956145.png)